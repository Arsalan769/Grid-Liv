<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>National Grid Dashboard Clone</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: sans-serif;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .tabs {
      text-align: center;
      margin-bottom: 20px;
    }
    .tabs button {
      margin: 0 10px;
      padding: 10px 20px;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .tabs button.active {
      background: #555;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    .card {
      background: #222;
      border-radius: 10px;
      padding: 20px;
    }
    canvas {
      width: 100% !important;
      height: 300px !important;
    }
  </style>
</head>
<body>
  <h1>National Grid Real-Time Dashboard</h1>
  <div class="tabs">
    <button class="tab active" onclick="changeRange('week')">Past Week</button>
    <button class="tab" onclick="changeRange('month')">Past Month</button>
    <button class="tab" onclick="changeRange('all')">All Time</button>
  </div>

  <div class="grid">
    <div class="card">
      <h3>Price per MWh (Bitcoin)</h3>
      <canvas id="priceChart"></canvas>
    </div>
    <div class="card">
      <h3>Demand (Temperature)</h3>
      <canvas id="demandChart"></canvas>
    </div>
    <div class="card">
      <h3>Emissions per kWh (Air Quality)</h3>
      <canvas id="emissionChart"></canvas>
    </div>
    <div class="card">
      <h3>Transfers (Simulated)</h3>
      <canvas id="transferChart"></canvas>
    </div>
  </div>

  <script>
    const backendUrl = "https://argrid.glitch.me/api";
    const charts = {};

    const metrics = [
      { id: "priceChart", key: "price", label: "Bitcoin Price (USD)", color: "#00c896" },
      { id: "demandChart", key: "demand", label: "Temperature (Â°C)", color: "#f39c12" },
      { id: "emissionChart", key: "emission", label: "Air Quality (PM2.5)", color: "#e74c3c" },
      { id: "transferChart", key: "transfer", label: "Transfers (GW)", color: "#3498db" }
    ];

    async function fetchData(metric) {
      const res = await fetch(`${backendUrl}/${metric}`);
      const json = await res.json();
      return json.map(d => ({
        time: d.time || d.timestamp || d.date || 'N/A',
        value: d.value || d.price || d.demand || d.transfer || d.intensity || 0
      }));
    }

    async function renderCharts() {
      for (const m of metrics) {
        const data = await fetchData(m.key);
        const ctx = document.getElementById(m.id).getContext('2d');
        charts[m.key] = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.map(d => d.time),
            datasets: [{
              label: m.label,
              data: data.map(d => d.value),
              borderColor: m.color,
              backgroundColor: m.color + '33',
              fill: true,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { labels: { color: "#fff" } } },
            scales: {
              x: { ticks: { color: "#ccc" } },
              y: { ticks: { color: "#ccc" } }
            }
          }
        });
      }
    }

    function changeRange(range) {
      document.querySelectorAll(".tab").forEach(btn => btn.classList.remove("active"));
      event.target.classList.add("active");
      // Optional: trigger re-fetch for different range
    }

    renderCharts();
  </script>
</body>
</html>
